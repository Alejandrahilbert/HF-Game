<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Cockpit Cleanup Challenge</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Permissions-Policy" content="interest-cohort=()">
  <style>
    :root {
      --ink: #0c0c1c;
      --panel: #11162b;
      --panel-2: #161b35;
      --accent: #6ef3c5;
      --accent-2: #ffcf58;
      --alert: #ff6b6b;
      --grid: rgba(255, 255, 255, 0.06);
      --text: #f5f8ff;
      --muted: #8fa4c2;
      --focus: #4cb3ff;
      --shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
      --radius: 14px;
      --pixel: "Press Start 2P", "VT323", "Courier New", monospace;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      background: radial-gradient(circle at 20% 20%, #1a2140, #0b0f20 60%),
        radial-gradient(circle at 80% 0%, #1d2348, #0b0f20 55%);
      color: var(--text);
      font-family: var(--pixel);
      letter-spacing: 0.4px;
    }

    h1, h2, h3 { margin: 0; }

    .frame {
      max-width: 1280px;
      margin: 0 auto;
      padding: 20px 18px 28px;
    }

    .top-bar {
      background: linear-gradient(135deg, #1b2346, #141a30);
      border: 2px solid #1f2c52;
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      padding: 18px 18px 14px;
      display: grid;
      gap: 12px;
    }

    .top-bar .title {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 22px;
    }

    .title .badge {
      background: var(--accent);
      color: #062016;
      padding: 6px 10px;
      border-radius: 8px;
      font-size: 12px;
      box-shadow: 0 3px 0 #2d8d6e;
    }

    .subtitle {
      color: var(--muted);
      font-size: 12px;
      line-height: 1.6;
    }

    .layout {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 18px;
      margin-top: 16px;
    }

    @media (max-width: 900px) {
      .layout { grid-template-columns: 1fr; }
    }

    .cockpit {
      background: linear-gradient(180deg, #10162e, #0b0f22);
      border: 2px solid #1f2a4f;
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
    }

    .cockpit::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image:
        linear-gradient(var(--grid) 1px, transparent 1px),
        linear-gradient(90deg, var(--grid) 1px, transparent 1px);
      background-size: 40px 40px;
      pointer-events: none;
      opacity: 0.6;
    }

    .cockpit-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
      z-index: 2;
      margin-bottom: 12px;
      gap: 10px;
    }

    .cockpit-header h2 { font-size: 16px; }

    .cockpit-hint {
      color: var(--muted);
      font-size: 11px;
      line-height: 1.4;
    }

    .instrument-area {
      position: relative;
      border: 2px dashed rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      min-height: 520px;
      padding: 10px;
      overflow: hidden;
      background: linear-gradient(160deg, rgba(108, 168, 255, 0.08), rgba(78, 242, 197, 0.06));
    }

    .instrument {
      position: absolute;
      width: 170px;
      min-height: 118px;
      background: var(--panel);
      border: 2px solid #2b345d;
      border-radius: 10px;
      padding: 10px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.32);
      cursor: grab;
      transition: transform 0.08s ease, border 0.1s ease, box-shadow 0.08s ease;
      user-select: none;
    }

    .instrument:active { cursor: grabbing; }

    .instrument h3 {
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .instrument h3 span {
      background: rgba(255, 255, 255, 0.08);
      padding: 4px 6px;
      border-radius: 6px;
      font-size: 10px;
      color: var(--muted);
    }

    .instrument .readout {
      font-size: 24px;
      margin: 10px 0 6px;
      color: var(--accent-2);
      text-shadow: 0 0 6px rgba(255, 207, 88, 0.4);
    }

    .instrument .notes {
      font-size: 10px;
      color: var(--muted);
      line-height: 1.5;
    }

    .instrument.alert {
      border-color: var(--alert);
      box-shadow: 0 0 14px rgba(255, 107, 107, 0.6);
      animation: pulse 0.6s infinite;
    }

    .instrument.focused {
      border-color: var(--focus);
      box-shadow: 0 0 14px rgba(76, 179, 255, 0.7);
    }

    @keyframes pulse {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-2px); }
    }

    .focus-zone {
      position: absolute;
      bottom: 12px;
      left: 50%;
      transform: translateX(-50%);
      width: 82%;
      min-height: 120px;
      border: 2px dashed var(--focus);
      border-radius: 10px;
      color: var(--focus);
      display: grid;
      place-items: center;
      text-align: center;
      padding: 12px;
      background: rgba(76, 179, 255, 0.07);
      z-index: 1;
      pointer-events: none;
      font-size: 11px;
    }

    .control-panel {
      background: linear-gradient(180deg, #141a31, #0e1428);
      border: 2px solid #1f2c52;
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: var(--shadow);
      display: grid;
      gap: 14px;
      align-content: start;
    }

    .panel {
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid rgba(255, 255, 255, 0.06);
      border-radius: 10px;
      padding: 12px;
      display: grid;
      gap: 8px;
    }

    .panel h3 { font-size: 13px; }

    .meters { display: grid; gap: 10px; }

    .meter {
      display: grid;
      gap: 6px;
      font-size: 11px;
      color: var(--muted);
    }

    .meter-bar {
      position: relative;
      width: 100%;
      height: 14px;
      background: #101733;
      border: 1px solid #2c3863;
      border-radius: 6px;
      overflow: hidden;
    }

    .meter-bar .fill {
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, #38ef7d, #11998e);
      width: 50%;
      transition: width 0.25s ease;
    }

    .meter-bar .fill.caution { background: linear-gradient(90deg, #ffcf58, #ff8a00); }
    .meter-bar .fill.alert { background: linear-gradient(90deg, #ff6b6b, #c44536); }

    .controls { display: flex; flex-wrap: wrap; gap: 8px; }

    button {
      font-family: var(--pixel);
      font-size: 11px;
      background: var(--accent);
      color: #062016;
      border: 2px solid #1d8b66;
      border-radius: 8px;
      padding: 10px 12px;
      cursor: pointer;
      box-shadow: 0 5px 0 #166a4f;
      transition: transform 0.08s ease, box-shadow 0.08s ease;
    }

    button.secondary {
      background: #4cb3ff;
      color: #041425;
      border-color: #2b7bb3;
      box-shadow: 0 5px 0 #1f5d8a;
    }

    button:active {
      transform: translateY(2px);
      box-shadow: 0 3px 0 rgba(0, 0, 0, 0.35);
    }

    .event-log {
      max-height: 220px;
      overflow-y: auto;
      background: #0b0f23;
      border: 1px solid #1d2647;
      border-radius: 8px;
      padding: 10px;
      font-size: 11px;
      color: var(--muted);
      line-height: 1.6;
    }

    .log-entry { margin-bottom: 6px; }
    .log-entry strong { color: var(--accent-2); }

    .notes-list { margin: 0; padding-left: 16px; color: var(--muted); font-size: 11px; line-height: 1.6; }

    .hint {
      font-size: 11px;
      color: var(--muted);
      background: rgba(255, 255, 255, 0.04);
      padding: 8px;
      border-radius: 8px;
      border: 1px dashed rgba(255, 255, 255, 0.12);
      line-height: 1.5;
    }
  </style>
</head>
<body>
  <div class="frame">
    <header class="top-bar">
      <div class="title">
        <div class="badge">8-BIT LAB</div>
        <h1>Cockpit Cleanup Challenge</h1>
      </div>
      <div class="subtitle">
        Drag and drop instruments, respond to alerts, and test whether a tidier cockpit helps you fly smoother.
        This mini-game is built for middle school pilots to explore human factors: clutter, attention, and smart layout choices.
      </div>
    </header>

    <div class="layout">
      <section class="cockpit">
        <div class="cockpit-header">
          <div>
            <h2>Flight Deck Sandbox</h2>
            <div class="cockpit-hint">Move critical gauges closer together. Tap flashing panels fast to keep your crew score high.</div>
          </div>
          <div class="cockpit-hint">Tip: Cluster altitude, attitude, and airspeed inside the focus zone.</div>
        </div>
        <div class="instrument-area" id="instrument-area"></div>
        <div class="focus-zone" id="focus-zone">Focus Zone — tighter grouping = faster reactions</div>
      </section>

      <aside class="control-panel">
        <div class="panel">
          <h3>Mission Status</h3>
          <div class="meters">
            <div class="meter">
              <div>Situational Awareness</div>
              <div class="meter-bar"><div class="fill" id="awareness-bar"></div></div>
            </div>
            <div class="meter">
              <div>Clutter Level</div>
              <div class="meter-bar"><div class="fill caution" id="clutter-bar"></div></div>
            </div>
            <div class="meter">
              <div>Fatigue</div>
              <div class="meter-bar"><div class="fill alert" id="fatigue-bar"></div></div>
            </div>
          </div>
        </div>

        <div class="panel">
          <h3>Controls</h3>
          <div class="controls">
            <button id="start-btn">Start Simulation</button>
            <button id="stop-btn" class="secondary">Pause</button>
            <button id="shuffle-btn" class="secondary">Shuffle Clutter</button>
            <button id="reset-btn">Reset Layout</button>
          </div>
          <div class="hint">When alerts flash red, click that instrument quickly. Try flying once with clutter, then once after organizing.</div>
        </div>

        <div class="panel">
          <h3>Design Notebook</h3>
          <ul class="notes-list">
            <li>Which gauges belong closest together?</li>
            <li>How many clicks did clutter cost you?</li>
            <li>Write a rule that would help a real pilot.</li>
            <li>Sketch your best cockpit on paper after each round.</li>
          </ul>
        </div>

        <div class="panel">
          <h3>Event Log</h3>
          <div class="event-log" id="event-log"></div>
        </div>
      </aside>
    </div>
  </div>

  <script>
    const instrumentArea = document.getElementById('instrument-area');
    const focusZone = document.getElementById('focus-zone');
    const logEl = document.getElementById('event-log');
    const awarenessBar = document.getElementById('awareness-bar');
    const clutterBar = document.getElementById('clutter-bar');
    const fatigueBar = document.getElementById('fatigue-bar');

    const instruments = [
      { id: 'altimeter', label: 'Altimeter', readout: '12,300 ft', note: 'Altitude & pressure monitor.' },
      { id: 'attitude', label: 'Attitude', readout: 'Level — 2° up', note: 'Artificial horizon.' },
      { id: 'airspeed', label: 'Airspeed', readout: '245 kts', note: 'Pitch for speed before power.' },
      { id: 'heading', label: 'Heading', readout: '095°', note: 'Stay on course or drift east.' },
      { id: 'engine', label: 'Engine', readout: '92% thrust', note: 'Check temps & fuel flow.' },
      { id: 'radar', label: 'Weather Radar', readout: 'Cells NE', note: 'Storms clutter the map.' },
      { id: 'nav', label: 'Nav Radios', readout: 'VOR 114.3', note: 'Needle centers when tuned.' },
      { id: 'checklist', label: 'Checklist', readout: 'Approach', note: 'Tap to verify steps.' },
      { id: 'alert', label: 'Caution Lights', readout: 'No alerts', note: 'Blink = scan & respond.' }
    ];

    const state = {
      running: false,
      activeAlert: null,
      metrics: { awareness: 65, clutter: 65, fatigue: 20 },
      layout: {},
      timers: { events: null, fatigue: null },
    };

    function log(message, highlight) {
      const entry = document.createElement('div');
      entry.className = 'log-entry';
      entry.innerHTML = highlight ? `<strong>${message}</strong>` : message;
      logEl.prepend(entry);
      while (logEl.children.length > 20) logEl.removeChild(logEl.lastChild);
    }

    function randomPosition() {
      const areaRect = instrumentArea.getBoundingClientRect();
      const width = 170;
      const height = 120;
      const padding = 10;
      const x = Math.random() * (areaRect.width - width - padding * 2) + padding;
      const y = Math.random() * (areaRect.height - height - padding * 2) + padding;
      return { x, y };
    }

    function createInstrument(inst) {
      const el = document.createElement('div');
      el.className = 'instrument';
      el.draggable = true;
      el.dataset.id = inst.id;
      el.innerHTML = `
        <h3>${inst.label} <span>drag</span></h3>
        <div class="readout">${inst.readout}</div>
        <div class="notes">${inst.note}</div>
      `;

      el.addEventListener('dragstart', (e) => {
        e.dataTransfer.setData('text/plain', inst.id);
        const rect = el.getBoundingClientRect();
        el.dataset.offsetX = e.clientX - rect.left;
        el.dataset.offsetY = e.clientY - rect.top;
      });

      el.addEventListener('dragend', (e) => {
        const offsetX = Number(el.dataset.offsetX || 0);
        const offsetY = Number(el.dataset.offsetY || 0);
        const areaRect = instrumentArea.getBoundingClientRect();
        const newX = Math.min(Math.max(e.clientX - areaRect.left - offsetX, 4), areaRect.width - el.offsetWidth - 4);
        const newY = Math.min(Math.max(e.clientY - areaRect.top - offsetY, 4), areaRect.height - el.offsetHeight - 4);
        setPosition(el, { x: newX, y: newY });
        updateFocusFlag(el);
        scoreClutter();
      });

      el.addEventListener('click', () => {
        if (state.activeAlert && state.activeAlert.id === inst.id) {
          resolveAlert(inst.id, 'Acknowledged');
        }
      });

      instrumentArea.appendChild(el);
      const pos = randomPosition();
      setPosition(el, pos);
      state.layout[inst.id] = pos;
    }

    function setPosition(el, pos) {
      el.style.left = `${pos.x}px`;
      el.style.top = `${pos.y}px`;
      state.layout[el.dataset.id] = pos;
    }

    function resetLayout() {
      Array.from(document.querySelectorAll('.instrument')).forEach((el) => {
        const pos = randomPosition();
        setPosition(el, pos);
        el.classList.remove('focused');
      });
      scoreClutter();
      log('Layout reset — start testing new ideas!');
    }

    function shuffleClutter() {
      Array.from(document.querySelectorAll('.instrument')).forEach((el) => {
        const pos = randomPosition();
        setPosition(el, pos);
      });
      scoreClutter();
      log('We scattered the gauges. Try organizing them.');
    }

    function isInsideFocus(el) {
      const focusRect = focusZone.getBoundingClientRect();
      const instRect = el.getBoundingClientRect();
      return (
        instRect.left >= focusRect.left &&
        instRect.right <= focusRect.right &&
        instRect.top >= focusRect.top &&
        instRect.bottom <= focusRect.bottom
      );
    }

    function updateFocusFlag(el) {
      const inside = isInsideFocus(el);
      el.classList.toggle('focused', inside);
    }

    function scoreClutter() {
      const all = Array.from(document.querySelectorAll('.instrument'));
      const focused = all.filter(isInsideFocus);
      const focusScore = Math.min(100, 45 + focused.length * 8);
      const clutterScore = Math.max(20, 90 - focused.length * 10 - all.length);
      const fatigueScore = Math.min(100, state.metrics.fatigue + (all.length - focused.length));

      state.metrics.awareness = focusScore;
      state.metrics.clutter = clutterScore;
      state.metrics.fatigue = fatigueScore;
      renderMeters();
    }

    function renderMeters() {
      awarenessBar.style.width = `${state.metrics.awareness}%`;
      clutterBar.style.width = `${state.metrics.clutter}%`;
      fatigueBar.style.width = `${state.metrics.fatigue}%`;
    }

    function triggerAlert() {
      if (!state.running) return;
      const available = instruments.filter((i) => !state.activeAlert || state.activeAlert.id !== i.id);
      const inst = available[Math.floor(Math.random() * available.length)];
      const el = document.querySelector(`[data-id="${inst.id}"]`);
      state.activeAlert = { id: inst.id, started: performance.now() };
      el.classList.add('alert');
      el.querySelector('.notes').textContent = 'Alert: confirm and clear!';
      log(`${inst.label} flashing — click to clear.`);

      setTimeout(() => {
        if (state.activeAlert && state.activeAlert.id === inst.id) {
          resolveAlert(inst.id, 'Missed');
        }
      }, 5000);
    }

    function resolveAlert(id, result) {
      const el = document.querySelector(`[data-id="${id}"]`);
      if (!el) return;
      el.classList.remove('alert');
      el.querySelector('.notes').textContent = instruments.find((i) => i.id === id).note;

      if (result === 'Acknowledged') {
        const responseTime = Math.max(0, performance.now() - state.activeAlert.started);
        const focusBonus = isInsideFocus(el) ? 8 : 0;
        const speedScore = Math.max(5, 25 - responseTime / 400);
        state.metrics.awareness = Math.min(100, state.metrics.awareness + speedScore + focusBonus);
        state.metrics.clutter = Math.max(5, state.metrics.clutter - (speedScore / 2 + focusBonus));
        state.metrics.fatigue = Math.max(0, state.metrics.fatigue - (focusBonus / 2));
        log(`Cleared ${el.dataset.id} in ${(responseTime / 1000).toFixed(1)}s — nice!`, true);
      } else {
        state.metrics.awareness = Math.max(10, state.metrics.awareness - 8);
        state.metrics.clutter = Math.min(100, state.metrics.clutter + 8);
        state.metrics.fatigue = Math.min(100, state.metrics.fatigue + 6);
        log(`${el.dataset.id} ignored — cockpit felt messy.`, true);
      }

      state.activeAlert = null;
      renderMeters();
    }

    function startSimulation() {
      if (state.running) return;
      state.running = true;
      log('Simulation running — respond to alerts and reorganize.');
      state.timers.events = setInterval(triggerAlert, 3200);
      state.timers.fatigue = setInterval(() => {
        state.metrics.fatigue = Math.min(100, state.metrics.fatigue + 1);
        renderMeters();
      }, 1500);
    }

    function stopSimulation() {
      state.running = false;
      clearInterval(state.timers.events);
      clearInterval(state.timers.fatigue);
      state.timers = { events: null, fatigue: null };
      log('Simulation paused.');
    }

    function init() {
      instruments.forEach(createInstrument);
      scoreClutter();
      instrumentArea.addEventListener('dragover', (e) => e.preventDefault());
      document.getElementById('start-btn').addEventListener('click', startSimulation);
      document.getElementById('stop-btn').addEventListener('click', stopSimulation);
      document.getElementById('shuffle-btn').addEventListener('click', shuffleClutter);
      document.getElementById('reset-btn').addEventListener('click', resetLayout);
    }

    init();
  </script>
</body>
</html>

  <script>
    const instrumentArea = document.getElementById('instrument-area');
    const focusZone = document.getElementById('focus-zone');
    const logEl = document.getElementById('event-log');
    const awarenessBar = document.getElementById('awareness-bar');
    const clutterBar = document.getElementById('clutter-bar');
    const fatigueBar = document.getElementById('fatigue-bar');

    const instruments = [
      { id: 'altimeter', label: 'Altimeter', readout: '12,300 ft', note: 'Altitude & pressure monitor.' },
      { id: 'attitude', label: 'Attitude', readout: 'Level — 2° up', note: 'Artificial horizon.' },
      { id: 'airspeed', label: 'Airspeed', readout: '245 kts', note: 'Pitch for speed before power.' },
      { id: 'heading', label: 'Heading', readout: '095°', note: 'Stay on course or drift east.' },
      { id: 'engine', label: 'Engine', readout: '92% thrust', note: 'Check temps & fuel flow.' },
      { id: 'radar', label: 'Weather Radar', readout: 'Cells NE', note: 'Storms clutter the map.' },
      { id: 'nav', label: 'Nav Radios', readout: 'VOR 114.3', note: 'Needle centers when tuned.' },
      { id: 'checklist', label: 'Checklist', readout: 'Approach', note: 'Tap to verify steps.' },
      { id: 'alert', label: 'Caution Lights', readout: 'No alerts', note: 'Blink = scan & respond.' }
    ];

    const state = {
      running: false,
      activeAlert: null,
      metrics: { awareness: 65, clutter: 65, fatigue: 20 },
      layout: {},
      timers: { events: null, fatigue: null },
    };

    function log(message, highlight) {
      const entry = document.createElement('div');
      entry.className = 'log-entry';
      entry.innerHTML = highlight ? `<strong>${message}</strong>` : message;
      logEl.prepend(entry);
      while (logEl.children.length > 20) logEl.removeChild(logEl.lastChild);
    }

    function randomPosition() {
      const areaRect = instrumentArea.getBoundingClientRect();
      const width = 170;
      const height = 120;
      const padding = 10;
      const x = Math.random() * (areaRect.width - width - padding * 2) + padding;
      const y = Math.random() * (areaRect.height - height - padding * 2) + padding;
      return { x, y };
    }

    function createInstrument(inst) {
      const el = document.createElement('div');
      el.className = 'instrument';
      el.draggable = true;
      el.dataset.id = inst.id;
      el.innerHTML = `
        <h3>${inst.label} <span>drag</span></h3>
        <div class="readout">${inst.readout}</div>
        <div class="notes">${inst.note}</div>
      `;

      el.addEventListener('dragstart', (e) => {
        e.dataTransfer.setData('text/plain', inst.id);
        const rect = el.getBoundingClientRect();
        el.dataset.offsetX = e.clientX - rect.left;
        el.dataset.offsetY = e.clientY - rect.top;
      });

      el.addEventListener('dragend', (e) => {
        const offsetX = Number(el.dataset.offsetX || 0);
        const offsetY = Number(el.dataset.offsetY || 0);
        const areaRect = instrumentArea.getBoundingClientRect();
        const newX = Math.min(Math.max(e.clientX - areaRect.left - offsetX, 4), areaRect.width - el.offsetWidth - 4);
        const newY = Math.min(Math.max(e.clientY - areaRect.top - offsetY, 4), areaRect.height - el.offsetHeight - 4);
        setPosition(el, { x: newX, y: newY });
        updateFocusFlag(el);
        scoreClutter();
      });

      el.addEventListener('click', () => {
        if (state.activeAlert && state.activeAlert.id === inst.id) {
          resolveAlert(inst.id, 'Acknowledged');
        }
      });

      instrumentArea.appendChild(el);
      const pos = randomPosition();
      setPosition(el, pos);
      state.layout[inst.id] = pos;
    }

    function setPosition(el, pos) {
      el.style.left = `${pos.x}px`;
      el.style.top = `${pos.y}px`;
      state.layout[el.dataset.id] = pos;
    }

    function resetLayout() {
      Array.from(document.querySelectorAll('.instrument')).forEach((el) => {
        const pos = randomPosition();
        setPosition(el, pos);
        el.classList.remove('focused');
      });
      scoreClutter();
      log('Layout reset — start testing new ideas!');
    }

    function shuffleClutter() {
      Array.from(document.querySelectorAll('.instrument')).forEach((el) => {
        const pos = randomPosition();
        setPosition(el, pos);
      });
      scoreClutter();
      log('We scattered the gauges. Try organizing them.');
    }

    function isInsideFocus(el) {
      const focusRect = focusZone.getBoundingClientRect();
      const instRect = el.getBoundingClientRect();
      return (
        instRect.left >= focusRect.left &&
        instRect.right <= focusRect.right &&
        instRect.top >= focusRect.top &&
        instRect.bottom <= focusRect.bottom
      );
    }

    function updateFocusFlag(el) {
      const inside = isInsideFocus(el);
      el.classList.toggle('focused', inside);
    }

    function scoreClutter() {
      const all = Array.from(document.querySelectorAll('.instrument'));
      const focused = all.filter(isInsideFocus);
      const focusScore = Math.min(100, 45 + focused.length * 8);
      const clutterScore = Math.max(20, 90 - focused.length * 10 - all.length);
      const fatigueScore = Math.min(100, state.metrics.fatigue + (all.length - focused.length));

      state.metrics.awareness = focusScore;
      state.metrics.clutter = clutterScore;
      state.metrics.fatigue = fatigueScore;
      renderMeters();
    }

    function renderMeters() {
      awarenessBar.style.width = `${state.metrics.awareness}%`;
      clutterBar.style.width = `${state.metrics.clutter}%`;
      fatigueBar.style.width = `${state.metrics.fatigue}%`;
    }

    function triggerAlert() {
      if (!state.running) return;
      const available = instruments.filter((i) => !state.activeAlert || state.activeAlert.id !== i.id);
      const inst = available[Math.floor(Math.random() * available.length)];
      const el = document.querySelector(`[data-id="${inst.id}"]`);
      state.activeAlert = { id: inst.id, started: performance.now() };
      el.classList.add('alert');
      el.querySelector('.notes').textContent = 'Alert: confirm and clear!';
      log(`${inst.label} flashing — click to clear.`);

      setTimeout(() => {
        if (state.activeAlert && state.activeAlert.id === inst.id) {
          resolveAlert(inst.id, 'Missed');
        }
      }, 5000);
    }

    function resolveAlert(id, result) {
      const el = document.querySelector(`[data-id="${id}"]`);
      if (!el) return;
      el.classList.remove('alert');
      el.querySelector('.notes').textContent = instruments.find((i) => i.id === id).note;

      if (result === 'Acknowledged') {
        const responseTime = Math.max(0, performance.now() - state.activeAlert.started);
        const focusBonus = isInsideFocus(el) ? 8 : 0;
        const speedScore = Math.max(5, 25 - responseTime / 400);
        state.metrics.awareness = Math.min(100, state.metrics.awareness + speedScore + focusBonus);
        state.metrics.clutter = Math.max(5, state.metrics.clutter - (speedScore / 2 + focusBonus));
        state.metrics.fatigue = Math.max(0, state.metrics.fatigue - (focusBonus / 2));
        log(`Cleared ${el.dataset.id} in ${(responseTime / 1000).toFixed(1)}s — nice!`, true);
      } else {
        state.metrics.awareness = Math.max(10, state.metrics.awareness - 8);
        state.metrics.clutter = Math.min(100, state.metrics.clutter + 8);
        state.metrics.fatigue = Math.min(100, state.metrics.fatigue + 6);
        log(`${el.dataset.id} ignored — cockpit felt messy.`, true);
      }

      state.activeAlert = null;
      renderMeters();
    }

    function startSimulation() {
      if (state.running) return;
      state.running = true;
      log('Simulation running — respond to alerts and reorganize.');
      state.timers.events = setInterval(triggerAlert, 3200);
      state.timers.fatigue = setInterval(() => {
        state.metrics.fatigue = Math.min(100, state.metrics.fatigue + 1);
        renderMeters();
      }, 1500);
    }

    function stopSimulation() {
      state.running = false;
      clearInterval(state.timers.events);
      clearInterval(state.timers.fatigue);
      state.timers = { events: null, fatigue: null };
      log('Simulation paused.');
    }

    function init() {
      instruments.forEach(createInstrument);
      scoreClutter();
      instrumentArea.addEventListener('dragover', (e) => e.preventDefault());
      document.getElementById('start-btn').addEventListener('click', startSimulation);
      document.getElementById('stop-btn').addEventListener('click', stopSimulation);
      document.getElementById('shuffle-btn').addEventListener('click', shuffleClutter);
      document.getElementById('reset-btn').addEventListener('click', resetLayout);
    }

    init();
  </script>
</body>
</html>
