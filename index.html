<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cockpit Cleanup Lab</title>
  <style>
    :root {
      --bg: #0d1b2a;
      --panel: #1b263b;
      --accent: #f08c00;
      --glow: #70e000;
      --text: #f1f5f9;
      --muted: #9aa7b8;
      --danger: #ff595e;
      --shadow: 0 14px 30px rgba(0, 0, 0, 0.3);
      --radius: 12px;
      --pixel: 'Press Start 2P', 'Courier New', monospace;
    }

    @font-face {
      font-family: 'Press Start 2P';
      font-style: normal;
      font-weight: 400;
      src: local('Press Start 2P'),
           url('https://fonts.gstatic.com/s/pressstart2p/v14/e3t4euO8T-267oIAQAu6jDQyK3n1iaQ.woff2')
             format('woff2');
      font-display: swap;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      background: radial-gradient(circle at 20% 20%, #102542 0, #0b1628 30%, #050910 100%);
      color: var(--text);
      font-family: var(--pixel);
      letter-spacing: 0.5px;
      display: flex;
      justify-content: center;
      padding: 28px 14px 60px;
    }

    .shell {
      width: 1200px;
      background: var(--panel);
      border: 3px solid #415a77;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px;
      display: grid;
      grid-template-columns: 360px 1fr;
      gap: 18px;
    }

    @media (max-width: 1100px) {
      .shell { grid-template-columns: 1fr; }
      .scoreboard { order: 2; }
      .playfield { order: 1; }
    }

    h1 {
      margin: 0 0 10px;
      color: var(--glow);
      text-shadow: 0 0 8px rgba(112, 224, 0, 0.5);
      font-size: 22px;
    }

    p {
      margin: 0 0 12px;
      line-height: 1.5;
      color: var(--muted);
      font-size: 12px;
    }

    .panel {
      background: #111826;
      border: 2px solid #23324a;
      border-radius: var(--radius);
      padding: 14px;
      box-shadow: inset 0 0 0 2px rgba(255, 255, 255, 0.04);
    }

    .scoreboard .hint {
      color: #cbd5e1;
      font-size: 12px;
      margin-bottom: 10px;
    }

    .metrics {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
    }

    .metric {
      background: #162033;
      border: 2px solid #24334f;
      padding: 10px;
      border-radius: 10px;
    }

    .metric .label {
      color: var(--muted);
      font-size: 11px;
      margin-bottom: 6px;
    }

    .metric .value {
      font-size: 18px;
      color: #f8fafc;
    }

    .legend {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 8px;
      margin-top: 12px;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: #0f192a;
      border: 2px solid #24334f;
      padding: 8px 10px;
      border-radius: 10px;
      font-size: 11px;
    }

    .dot {
      width: 12px;
      height: 12px;
      border-radius: 3px;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 12px 0;
    }

    button {
      font-family: var(--pixel);
      border: 2px solid #24334f;
      background: #0f1a2a;
      color: var(--text);
      padding: 10px 14px;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.2s ease;
      box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.35);
      font-size: 11px;
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 14px rgba(0, 0, 0, 0.3);
      background: #142139;
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .danger {
      border-color: var(--danger);
      color: var(--danger);
    }

    .playfield {
      position: relative;
      background: #0a1220;
      border: 2px dashed #23324a;
      border-radius: var(--radius);
      min-height: 620px;
      overflow: hidden;
    }

    .grid-lines {
      position: absolute;
      inset: 0;
      background-image:
        linear-gradient(#11253f 1px, transparent 1px),
        linear-gradient(90deg, #11253f 1px, transparent 1px);
      background-size: 60px 60px;
      opacity: 0.4;
      pointer-events: none;
    }

    .control {
      position: absolute;
      width: 150px;
      background: linear-gradient(180deg, #1f2c43, #0e1626);
      border: 2px solid #2f3f5d;
      border-radius: 12px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.35);
      padding: 12px;
      cursor: grab;
      user-select: none;
      transition: transform 0.12s ease, border-color 0.12s ease, box-shadow 0.12s ease;
    }

    .control:active {
      transform: translateY(1px);
    }

    .control.testing {
      animation: pulse 1s infinite;
      border-color: var(--glow);
      box-shadow: 0 0 0 2px rgba(112, 224, 0, 0.2);
    }

    .control .label {
      font-size: 11px;
      color: #e2e8f0;
      margin-bottom: 6px;
    }

    .control .value {
      font-size: 16px;
      color: #fff;
      text-shadow: 0 0 4px rgba(0, 0, 0, 0.5);
    }

    .control .tag {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-top: 8px;
      font-size: 10px;
      background: #0c1a2b;
      border: 1px solid #24334f;
      padding: 6px 8px;
      border-radius: 8px;
    }

    .control.altitude { border-color: #8ecae6; }
    .control.throttle { border-color: #f08c00; }
    .control.heading { border-color: #a78bfa; }
    .control.flaps   { border-color: #ffb703; }
    .control.gear    { border-color: #ef476f; }
    .control.radio   { border-color: #06d6a0; }
    .control.fuel    { border-color: #ffd166; }
    .control.horizon { border-color: #64dfdf; }

    @keyframes pulse {
      0%   { box-shadow: 0 0 0 2px rgba(112, 224, 0, 0.3); }
      50%  { box-shadow: 0 0 0 8px rgba(112, 224, 0, 0.05); }
      100% { box-shadow: 0 0 0 2px rgba(112, 224, 0, 0.3); }
    }

    .status {
      background: #0f1a2b;
      border: 2px solid #22314a;
      border-radius: 10px;
      padding: 12px;
      margin-top: 10px;
      min-height: 92px;
      font-size: 12px;
      color: #e2e8f0;
    }

    .status .title {
      color: var(--glow);
      margin-bottom: 6px;
      font-size: 12px;
    }

    .status .log {
      color: #cbd5e1;
      line-height: 1.4;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <div class="shell">
    <section class="scoreboard">
      <h1>Cockpit Cleanup Lab</h1>
      <p>
        Drag instruments to design a kid-friendly cockpit. Run a flight test to see
        how quickly you can find the right control before and after you tidy the panel.
      </p>

      <div class="panel">
        <div class="hint">
          Try clustering related controls. Clear grouping is a core human factors principle.
        </div>

        <div class="metrics">
          <div class="metric">
            <div class="label">Latest test</div>
            <div class="value" id="latest-time">—</div>
          </div>
          <div class="metric">
            <div class="label">Best time</div>
            <div class="value" id="best-time">—</div>
          </div>
          <div class="metric">
            <div class="label">Avg per step</div>
            <div class="value" id="avg-step">—</div>
          </div>
          <div class="metric">
            <div class="label">Errors</div>
            <div class="value" id="errors">0</div>
          </div>
        </div>

        <div class="controls">
          <button id="start-test">Start flight test</button>
          <button id="organize">Organize mode: Off</button>
          <button id="reset" class="danger">Reset clutter</button>
        </div>

        <div class="legend">
          <div class="badge">
            <span class="dot" style="background:#8ecae6"></span>Flight data
          </div>
          <div class="badge">
            <span class="dot" style="background:#f08c00"></span>Power &amp; thrust
          </div>
          <div class="badge">
            <span class="dot" style="background:#a78bfa"></span>Navigation
          </div>
          <div class="badge">
            <span class="dot" style="background:#06d6a0"></span>Comms &amp; status
          </div>
        </div>
      </div>

      <div class="status">
        <div class="title">Mission log</div>
        <div class="log" id="log">
          Arrange controls, then tap "Start flight test". When the prompt appears,
          click the highlighted control as fast as you can.
        </div>
      </div>
    </section>

    <section class="playfield">
      <div class="grid-lines"></div>
    </section>
  </div>

  <script>
    const playfield = document.querySelector('.playfield');
    const logEl = document.getElementById('log');
    const latestEl = document.getElementById('latest-time');
    const bestEl = document.getElementById('best-time');
    const avgEl = document.getElementById('avg-step');
    const errorEl = document.getElementById('errors');
    const startBtn = document.getElementById('start-test');
    const organizeBtn = document.getElementById('organize');
    const resetBtn = document.getElementById('reset');

    const controls = [
      { key: 'altitude', label: 'Altimeter',    value: '12,200 ft',      tag: 'Flight data' },
      { key: 'throttle', label: 'Throttle',     value: '65% power',      tag: 'Power' },
      { key: 'heading',  label: 'Heading',      value: '090° east',      tag: 'Navigation' },
      { key: 'flaps',    label: 'Flaps',        value: '10° deployed',   tag: 'Lift' },
      { key: 'gear',     label: 'Landing Gear', value: 'Down & locked',  tag: 'Landing' },
      { key: 'radio',    label: 'Radio',        value: 'Tower: 118.4',   tag: 'Comms' },
      { key: 'fuel',     label: 'Fuel Gauge',   value: '82% remaining',  tag: 'Fuel' },
      { key: 'horizon',  label: 'Horizon',      value: 'Level flight',   tag: 'Attitude' },
    ];

    const tasks = [
      { key: 'throttle', message: 'Add thrust for takeoff' },
      { key: 'heading',  message: 'Turn to heading 090°' },
      { key: 'altitude', message: 'Check 12,000 ft' },
      { key: 'gear',     message: 'Gear down for landing' },
      { key: 'radio',    message: 'Call the tower' },
      { key: 'flaps',    message: 'Set flaps to 10°' },
      { key: 'fuel',     message: 'Verify fuel' },
      { key: 'horizon',  message: 'Confirm level wings' },
    ];

    let elements = new Map();
    let dragging = null;
    let offset = { x: 0, y: 0 };
    let organizeMode = false;
    let currentTaskIndex = 0;
    let testActive = false;
    let times = [];
    let best = null;
    let errors = 0;
    let taskStart = null;

    function randomPosition() {
      const padding = 30;
      const maxX = playfield.clientWidth - 160;
      const maxY = playfield.clientHeight - 180;
      return {
        x: Math.random() * (maxX - padding) + padding,
        y: Math.random() * (maxY - padding) + padding,
      };
    }

    function createControl(ctrl) {
      const div = document.createElement('div');
      div.className = 'control ' + ctrl.key;
      div.dataset.key = ctrl.key;
      div.innerHTML = `
        <div class="label">${ctrl.label}</div>
        <div class="value">${ctrl.value}</div>
        <div class="tag">${ctrl.tag}</div>
      `;
      const pos = randomPosition();
      div.style.left = pos.x + 'px';
      div.style.top = pos.y + 'px';
      playfield.appendChild(div);
      elements.set(ctrl.key, div);
    }

    function populateControls() {
      playfield.innerHTML = '<div class="grid-lines"></div>';
      elements.clear();
      controls.forEach(createControl);
    }

    function setLog(message) {
      logEl.textContent = message;
    }

    function setMetrics({ latest, avg, err }) {
      latestEl.textContent = latest ?? '—';
      avgEl.textContent = avg ?? '—';
      errorEl.textContent = err ?? errors;
      bestEl.textContent = best === null ? '—' : best.toFixed(2) + 's';
    }

    function formatSeconds(ms) {
      return (ms / 1000).toFixed(2);
    }

    function startTest() {
      currentTaskIndex = 0;
      times = [];
      errors = 0;
      testActive = true;
      startBtn.disabled = true;
      setLog('Flight test running: click the highlighted control that matches each prompt.');
      nextTask();
    }

    function nextTask() {
      Array.from(elements.values()).forEach(el => el.classList.remove('testing'));
      if (currentTaskIndex >= tasks.length) {
        finishTest();
        return;
      }
      const task = tasks[currentTaskIndex];
      const el = elements.get(task.key);
      if (el) el.classList.add('testing');
      setLog('Task ' + (currentTaskIndex + 1) + '/' + tasks.length + ': ' + task.message);
      taskStart = performance.now();
    }

    function finishTest() {
      testActive = false;
      startBtn.disabled = false;
      Array.from(elements.values()).forEach(el => el.classList.remove('testing'));
      const total = times.reduce((a, b) => a + b, 0);
      const avg = times.length ? total / times.length : 0;
      best = best === null ? total : Math.min(best, total);
      setMetrics({
        latest: formatSeconds(total) + 's',
        avg: formatSeconds(avg) + 's',
        err: errors
      });
      setLog(
        'Flight complete! Total time: ' + formatSeconds(total) +
        's | Avg step: ' + formatSeconds(avg) +
        's | Errors: ' + errors +
        '. Try reorganizing the cockpit to beat your time.'
      );
    }

    function handleControlClick(key) {
      if (!testActive) return;
      const task = tasks[currentTaskIndex];
      if (task.key === key) {
        const elapsed = performance.now() - taskStart;
        times.push(elapsed);
        currentTaskIndex += 1;
        nextTask();
      } else {
        errors += 1;
        errorEl.textContent = errors;
        setLog('Oops, wrong control. We need: ' + task.message);
      }
    }

    function toggleOrganize() {
      organizeMode = !organizeMode;
      organizeBtn.textContent = 'Organize mode: ' + (organizeMode ? 'On' : 'Off');
      setLog(
        organizeMode
          ? 'Drag controls into groups that feel natural.'
          : 'Organize mode off. Start the flight test to compare.'
      );
    }

    function resetClutter() {
      populateControls();
      setLog('Controls scattered. Try reorganizing them to reduce searching time.');
      setMetrics({ latest: '—', avg: '—', err: 0 });
      errors = 0;
      times = [];
      testActive = false;
      startBtn.disabled = false;
    }

    function handleMouseDown(e) {
      const target = e.target.closest('.control');
      if (!target || !organizeMode) return;
      dragging = target;
      const rect = target.getBoundingClientRect();
      offset.x = e.clientX - rect.left;
      offset.y = e.clientY - rect.top;
      target.style.cursor = 'grabbing';
    }

    function handleMouseMove(e) {
      if (!dragging) return;
      const bounds = playfield.getBoundingClientRect();
      let x = e.clientX - bounds.left - offset.x;
      let y = e.clientY - bounds.top - offset.y;
      x = Math.max(10, Math.min(bounds.width - dragging.clientWidth - 10, x));
      y = Math.max(10, Math.min(bounds.height - dragging.clientHeight - 10, y));
      dragging.style.left = x + 'px';
      dragging.style.top = y + 'px';
    }

    function handleMouseUp() {
      if (dragging) dragging.style.cursor = 'grab';
      dragging = null;
    }

    playfield.addEventListener('mousedown', handleMouseDown);
    window.addEventListener('mousemove', handleMouseMove);
    window.addEventListener('mouseup', handleMouseUp);

    playfield.addEventListener('click', (e) => {
      const target = e.target.closest('.control');
      if (!target) return;
      handleControlClick(target.dataset.key);
    });

    startBtn.addEventListener('click', startTest);
    organizeBtn.addEventListener('click', toggleOrganize);
    resetBtn.addEventListener('click', resetClutter);

    populateControls();
    setLog(
      'Arrange controls, then tap "Start flight test". ' +
      'When the prompt appears, click the highlighted control as fast as you can.'
    );
    setMetrics({ latest: '—', avg: '—', err: 0 });
  </script>
</body>
</html>
